setup:
  addons:
    - plan: heroku-postgresql
      as: DATABASE
    - plan: heroku-redis
      as: redis
build:
  docker:
    web: Dockerfile
    worker: Dockerfile.worker

  config:
    RAILS_ENV: development
    FOO: bar
release:
  command:
    - ./deployment-tasks.sh
  image: worker
run:
  web: bash -c "python /code/manage.py migrate --noinput && gunicorn ebay_alerts.wsgi:application --bind 0.0.0.0:8000 --reload -t300"
  worker:
    command:
      -  bash -c "celery -A ebay_alerts inspect registered && celery -A ebay_alerts worker -l info"
    image: web